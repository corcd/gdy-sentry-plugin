"use strict";function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var Sentry=require("@sentry/browser");function Report(e){try{var t=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};setTimeout((function(){"info"===e?(Sentry.setTag("Uin",a.uin),Sentry.setExtra("data",r),Sentry.captureMessage(t,"info")):"error"===e&&(Sentry.setTag("Uin",a.uin),Sentry.setExtra("data",r),Sentry.captureException(new Error(t))),Promise.resolve().then((function(){n()}))}),a.outtime)},r=function(e,t){var r=t.responseURL;if(!o.some((function(e){return r.includes(e)})))switch(e){case"done":Sentry.setTag("Uin",a.uin),Sentry.setTag("Appid",a.Appid),Sentry.setExtra("data",t),Sentry.captureException(new Error("Api Error:".concat(t.msg||t.statusText)));break;case"error":Sentry.setTag("Uin",a.uin),Sentry.setTag("Appid",a.Appid),Sentry.setExtra("data",t),Sentry.captureException(new Error("Request Error:".concat(t.statusText)))}},n=function(){window.performance&&window.performance.clearResourceTimings&&performance.clearResourceTimings()},o=["/sockjs-node/info","arms-retcode.aliyuncs.com","ynuf.aliapp.org"],a={dsn:"",version:"1.0.0",env:"",appid:"",uin:0,name:"",outtime:300,filterUrl:[],isPage:!1,isAjax:!0,isError:!0};Object.assign(a,e),a.filterUrl=a.filterUrl.concat(o);var i="";switch(a.env){case"TEST":i="development";break;case"PRE":i="preview";break;case"":default:i="production"}Sentry.init({dsn:a.dsn,release:a.version,environment:i}),Sentry.setUser({AppId:a.appid,Uin:a.uin,Name:a.name,Environment:i}),a.isError&&function(){window.addEventListener("error",(function(e){var r={t:(new Date).getTime(),msg:e.target.localName+" is load error",target:e.target.localName,type:e.type,resourceUrl:e.target.href||e.target.currentSrc};t("error","Resource Error",r)}),!0),window.onerror=function(e,r,n,o,a){setTimeout((function(){o=o||window.event&&window.event.errorCharacter||0;var i={t:(new Date).getTime(),msg:a&&a.stack?a.stack.toString():e,resourceUrl:r,line:n,col:o};t("error","Script Error",i)}),0)},window.addEventListener("unhandledrejection",(function(e){var r,n,o,a=e&&e.reason,i=a.hasOwnProperty("message")?a.message:"",s=(a.stack||"").match(/\(.+?\)/);s&&s.length&&(s=(s=(s=s[0]).replace(/\w.+[js|html]/g,(function(e){return r=e,""}))).split(":")),s&&s.length>1&&(o=parseInt(s[1]||0,10)),s&&s.length>2&&(n=parseInt(s[2]||0,10));var c={t:(new Date).getTime(),msg:i,resourceUrl:r,line:n,col:o};t("error","Unhandledrejection",c)}));var e=console.error;console.error=function(r){return setTimeout((function(){var e={t:(new Date).getTime(),msg:r,resourceUrl:location.href};t("error","Console Error",e)}),0),e.apply(console,arguments)}}(),(a.isAjax||a.isError)&&function(e){function t(t){return function(){var r=this.hasOwnProperty(t+"_")?this[t+"_"]:this.xhr[t],n=(e[t]||{}).getter;return n&&n(r,this)||r}}function r(t){return function(r){var n=this.xhr,o=this,a=e[t];if("function"==typeof a)n[t]=function(){e[t](o)||r.apply(n,arguments)};else{var i=(a||{}).setter;r=i&&i(r,o)||r;try{n[t]=r}catch(e){this[t+"_"]=r}}}}function n(t){return function(){var r=[].slice.call(arguments);if(!e[t]||!e[t].call(this,r,this.xhr))return this.xhr[t].apply(this.xhr,r)}}window._ahrealxhr=window._ahrealxhr||XMLHttpRequest,XMLHttpRequest=function(){for(var e in this.xhr=new window._ahrealxhr,this.xhr){var o="";try{o=_typeof(this.xhr[e])}catch(e){}"function"===o?this[e]=n(e):Object.defineProperty(this,e,{get:t(e),set:r(e)})}},window._ahrealxhr}({onreadystatechange:function(e){if(4===e.readyState){var t=e.xhr.responseURL?e.xhr.responseURL.split("?")[0]:"";if(a.filterUrl.some((function(e){return t.includes(e)}))||!t)return;setTimeout((function(){if(e.status<200||e.status>300){e.method=e.args.method;var n=e.xhr.response?JSON.parse(e.xhr.response):{},o={status:e.status,statusText:e.xhr.statusText||"",method:e.args.method,responseURL:e.args.url,data:n.data||null,msg:""};r("done",o)}else{var a=e.xhr.response?JSON.parse(e.xhr.response):{};if(t.includes("guangdianyun")&&0!==Number(a.errorCode)&&1!==Number(a.errorCode)){var i={origin:"gdy",status:e.status,statusText:e.xhr.statusText||"",method:e.args.method,responseURL:e.args.url,data:a.data||null,errorCode:a.errorCode||0,msg:a.errorMessage||""};r("done",i)}if(t.includes("aodian.com")&&0!==Number(a.code)){var s={origin:"aodian",status:e.status,statusText:e.xhr.statusText||"",method:e.args.method,responseURL:e.args.url,data:a.data||null,code:a.code||0,msg:a.msg||""};r("done",s)}}}),600)}},onerror:function(e){if(e.args){var t=e.args.url?e.args.url.split("?")[0]:"";if(a.filterUrl.some((function(e){return t.includes(e)}))||!t)return;var n={method:e.args.method,responseURL:t,statusText:"xhr request error"};r("error",n)}},open:function(e,t){this.args={url:e[1].split("?")[0],method:e[0]||"GET",type:"xmlhttprequest"},n()}}),window.addEventListener("load",(function(){a.isPage&&function(){if(window.performance){var e=performance.timing,r={width:document.documentElement.clientWidth||document.body.clientWidth,height:document.documentElement.clientHeight||document.body.clientHeight,dnst:e.domainLookupEnd-e.domainLookupStart||0,tcpt:e.connectEnd-e.connectStart||0,wit:e.responseStart-e.navigationStart||0,domt:e.domContentLoadedEventEnd-e.navigationStart||0,lodt:e.loadEventEnd-e.navigationStart||0,radt:e.fetchStart-e.navigationStart||0,rdit:e.redirectEnd-e.redirectStart||0,uodt:e.unloadEventEnd-e.unloadEventStart||0,reqt:e.responseEnd-e.requestStart||0,andt:e.domComplete-e.domInteractive||0};t("info","Page Performance",r)}}()}),!1)}catch(e){}}Report.init=function(e){var t={dsn:"",version:"1.0.0",env:""};Object.assign(t,e);var r="";switch(t.env){case"TEST":r="development";break;case"PRE":r="preview";break;case"":default:r="production"}Sentry.init({dsn:String(t.dsn),release:t.version,environment:r})},Report.setUser=function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";Sentry.setUser({AppId:e,Uin:t,Name:r,Environment:n})},Report.api=function(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};Sentry.configureScope((function(r){r.setTag("appid",e),r.setTag("uin",t)})),Sentry.setTag("Uin",t),Sentry.setTag("Appid",e),Sentry.setExtra("data",n),Sentry.captureException(new Error("Api Error:".concat(r)))},Report.info=function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"Info",n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};Sentry.configureScope((function(r){r.setTag("appid",e),r.setTag("uin",t)})),Sentry.setTag("Uin",t),Sentry.setTag("Appid",e),Sentry.setExtra("data",n),Sentry.captureMessage(r,"info")},Report.error=function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"New Error",n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};Sentry.configureScope((function(r){r.setTag("appid",e),r.setTag("uin",t)})),Sentry.setTag("Uin",t),Sentry.setTag("Appid",e),Sentry.setExtra("data",n),Sentry.captureException(new Error(r))},"object"===("undefined"==typeof exports?"undefined":_typeof(exports))?module.exports=Report:"function"==typeof define&&define.amd?define([],(function(){return Report})):window.Report=Report;